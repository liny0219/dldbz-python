### <center>项目贡献者: 大霸茶馆

#### 介绍
仅供交流学习用，请勿用于任何商业盈利

## 

``` json
{
  "type": "801", //type 801-80权利,802-80富足,803-80名声
  "ticket": "0", //票数
  "lv": "5", //等级
  "auto_battle": "1", //1-委托战斗 0-自定义战斗,目前仅支持委托战斗
  "isContinue": "0", //0-不继续 1-继续 设置为继续,在踩到回退或者旗子断开重启会卡住,待修复
  "round_time": "12", //大富翁卡死检测时间 12分钟
  "wait_time": "5", //没有响应状态时间 5分钟
  "check_interval": "0.1", // 检查间隔0.1秒
  "check_roll_dice_time": "2", // 扔骰子点击次数 加速丢骰子
  "check_roll_dice_interval": "0.1", // 点击骰子次数
  "crossing": {  // 设置路口转向,801-80权利,802-80富足,803-80名声,注意设置错误会导致卡住
    "801": [
      { // 第一个路口            
        "left": "[0,100]", // 路口时,0<=剩余步数<100走左边
        "right": "[100,100],[101,106]", //多规则配置示例,不会被匹配到 路口时,100<=剩余步数<100走左边或101<=剩余步数<106 走右边
        "default": "left" // 默认转向,由于剩余距离可能识别失败,一定需要配置默认转向,避免卡死
      },
      { // 第二个路口      
        "right": "[0,100]",
        "default": "right"
      },
      { // 第三个路口    
        "up": "[0,100]",
        "default": "up"
      },
      { // 第四个路口    
        "left": "[0,100]",
        "default": "left"
      }
    ],
    "802": [
      {
        "left": "[0,100]",
        "default": "right"
      },
      {
        "up": "[0,100]",
        "default": "up"
      },
      {
        "right": "[0,100]",
        "default": "right"
      }
    ],
    "803": [
      {
        "left": "[0,100]",
        "default": "left"
      },
      {
        "up": "[0,100]",
        "default": "up"
      }
    ]
  },
  "enemy_check": "1", // 战斗前是否检查敌人
  "enemy_match_threshold": "0.5", // 敌人图片精度
  "enemy": {
    "802": { // 财富盘
      "赫尔米尼亚": "./image/802/01.png" // boss图片,可自定义扩展,放在image/游戏盘编号/图片名称
    }
  },
  "action": { // 设置识别到敌人后的对应行动,以财富boss为例子,匹配到boss后,执行点击命令,优先攻击boss
    "802": {
      "赫尔米尼亚": [
        "Click,169,216" // 点击boss的坐标,坐标可从获取坐标功能获取
      ]
    }
  },
  "check_roll_rule": "1", // 是否使用自定义扔骰子规则 0-不使用自定义扔骰子规则,默认不使用BP,1-使用自定义扔骰子规则
  "check_roll_rule_wait": "0.1",
  "bp_type": "max", // max-匹配规则时使用最大值, match-匹配规则只有bp数量一致才会使用
  "bp": {
    "801": "[19,20,1],[21,19,2],[25,21,3]", //例如[100,50,0],[50,30,1],[30,0,3]说明从100(包含)到50(不包含),使用0bp,从50(包含)到30(不包含)使用1bp,从30(包含)到0(包含)使用3bp
    "802": "[14,12,1],[9,1,3]",
    "803": "[21,14,3],[12,12,2]"
  }
}
```
v1.3
优化巡检逻辑，每轮只截屏1次
开放巡检配置
config目录下monopoly.json
"isContinue": "0", 重启后是否继续游戏，目前如果检查还有问题，会卡住的话，建议0关闭
"check_interval": "0.2", 每轮巡检频率0.2秒
"check_roll_dice_time": "2", 丢出骰子后，加快动画点击次数，默认2
"check_roll_dice_interval": "0.2", 丢出骰子后，加快动画点击的间隔，默认0.2秒

v1.2
增加重启后是继续还是取消配置
增加是否输出日志配置
增加卡屏检查
优化扔骰子逻辑，减少丢出去的耗时

v1.1 
支持80权威游戏盘
支持80富足游戏盘
支持80名声游戏盘

#### 使用说明

1.  修改模拟器的分辨率为960x540
2.  在启动配置里修改adb port，雷电模拟器默认为127.0.0.1:5555，mumu模拟器默认为:127.0.0.1:16384

#### 战斗指令说明
- **BattleStart** - 战斗开始
- **BattleEnd** - 战斗结束，用来标记每场战斗的开始和结束。如果是子连战，可能需要标记多次。
- **Role,角色编号,技能编号,能量等级，敌人位置** - 控制角色使用指定技能攻击敌人。例子: `Role,1,2,3,x,y`，其中 x,y 是通过标记坐标按钮获取的敌人位置。
- **Boost** - 全体加成，提升所有角色的某些能力。
- **SwitchAll** - 全员交替，改变当前的战斗队形或角色顺序。
- **Attack** - 发起攻击，通常用于执行战斗命令。
- **Wait,500** - 等待500毫秒，用于控制动作间的时间延迟。
- **Skip,500** - 跳过500毫秒，用于快速跳过某些动作或等待。
- **Click,x,y** - 点击某个坐标，用来选中集火某个敌人。
- **SP,1(角色编号)** - 角色使用必杀技能，`SP,1` 表示第一个角色使用。


#### 更新说明
v2.8.4
增加守护进程,独立检查模拟器是否开启,app是否开启,是否长时间卡死,避免占用主线程执行时间

v2.8.3
移除检查大霸App是否关闭的时间间隔,可以立即检测关闭重启,但是会多40+ms的执行((后续守护进程减少这个时间)
移除检查模拟器是否关闭的时间间隔,可以立即检测关闭重启,但是会多40+ms的执行((后续守护进程减少这个时间)
增加模拟器断开后,主动重连功能(mumu模拟器需要主动重连)
增加启动时检查是否运行模拟器,如果连接失败,自动重连

v2.8.2
修复卡死大富翁界面的重启问题

v2.8.1
设置面板增加模拟器路径,检查不到指令时重启模拟器
设置面包增加打开日志目录功能

v2.8.0 (配置文件有更新,不能将旧版的复制过来使用)
修复自定义方向规则,如果剩余步数没有匹配到任何规则卡住的bug
修复bp识别的bug
增加bp匹配模式的配置
自定义方向规则支持同个方向,多个规则的配置
优化拉豆子的操作
优化配置文件出错提示

v2.7.2
调整拉BP的间隔

v2.7.1
优化资源释放,避免长时间挂机内存泄漏

v2.7.0
优化检查等待逻辑,减少cpu的消耗
修复图形识别异常处理逻辑的bug
修复无响应命令重启后的无法继续游戏

v2.6.4
修复大富翁战斗中偶现没有开始委托战斗
完善重启检查

v2.6.3
修复大富翁事件点击卡住问题

v2.6.2
修复黑龙盘更新后的选盘问题
设置增加端口设置按钮

v2.6.1
升级路口自定义规则,支持多个规则自动匹配
删除ocr预处理

v2.6.0
架构优化

v2.5.4
fix: 优化战斗逻辑,加快地图判断

v2.5.3
fix: 调整大富翁地图内检查逻辑,修复点击旅馆的对话导致重启

v2.5.2
调整统计信息展示

v2.5.1
在config/monopoly.json配置文件中增加是否开启识别敌人enemy_check配置 0 不开启,1开启

v2.5.0
在config/starup.json配置文件中增加package_name配置
OCR识别距离,增加抗锯齿处理\锐化处理\增强数字的边缘从而提升成功率
重构大富翁检查架构,減少一半冗余检查
补充战斗判断逻辑,规避卡在游戏战斗界面

v2.4.3
修复原地刷野重启问题
提高原地刷野效率
修复大富翁重启后没有点击标题问题

v2.4.2
增加原地刷野功能

v2.4.1
更新版本号从独立文件读取,防止修改端口复制文件,将版本号覆盖
更新ocr识别距离失败重试默认为4次,加快速度
增加ocr识别距离失败,保存失败图片,以便分析
更新暗月的拉豆子规则到默认配置
优化委托战斗前识别敌人逻辑

v2.4.0
优化整体的判断逻辑,加快大富翁里面响应的速度
修复重启后点击酒馆等菜单的bug

v2.3.5
修复2.3.4 中,路口识别异常的bug
修复2.3.4 中,整体速度慢的bug

v2.3.4
增加平均耗时统计
增加 部分日志
修改部分识别为图片
增强挂机稳定性,避免重启游戏后乱点与识别错误
优化大富翁识别逻辑,减少不必要的检查

v2.3.3
修改游戏盘增加自定义匹配敌人配置,由特征点改为图片匹配

v2.3.2
调整点击空白位置,避免卡路口

v2.3.1
游戏盘增加匹配敌人坐标的容差参数
游戏盘匹配敌人增加对应日志

v2.3.0
优化识别距离重试逻辑,增强准确度
游戏盘增加自定义匹配敌人配置
游戏盘增加自定义匹配敌人后,执行指令(目前只支持选中敌人,自定义战斗待完善)

v2.2.0
修复委托战斗点击逻辑,避免卡顿造成的重启与翻车
优化识别逻辑,增强识别距离准确度

v2.1.0
增加追忆之书功能,自定义战斗编辑系统

v1.9.0
增加历史日志功能
优化坐标采集逻辑

v1.8.0
优化启动逻辑
增加游戏盘扔骰子统计
打包ocr模型

v1.7.0
修复信息统计，翻车完成次数等
优化重试逻辑, 增强识别距离的成功率

v1.6.0
修复信息统计，翻车完成次数等
增强识别距离的成功率

v1.5.0
修复自定义规则重试次数不生效

v1.4.0
增加游戏盘自定义扔骰子设置
详情查看游戏盘配置文件